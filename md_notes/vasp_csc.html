<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Interface to VASP &mdash; solid_dmft  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />
      <link rel="stylesheet" href="../_static/plot_directive.css" type="text/css" />
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="How to do cRPA calculations with VASP" href="../cRPA_VASP/README.html" />
    <link rel="prev" title="Wannier90 interface" href="w90_interface.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #7E588A" >
            <a href="../index.html" class="icon icon-home"> solid_dmft
            <img src="../_static/logo_no_text.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                3.2.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../install.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../install.html#prerequisites">Prerequisites</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install.html#installation-via-pip">Installation via pip</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install.html#manual-installation-via-cmake">Manual installation via CMake</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install.html#docker-files-images">Docker files &amp; images</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install.html#version-compatibility">Version compatibility</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install.html#custom-cmake-options">Custom CMake options</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../documentation.html">Documentation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../documentation.html#code-structure">Code structure</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../documentation.html#dft-interface-notes">DFT interface notes</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="w90_interface.html">Wannier90 interface</a><ul>
<li class="toctree-l4"><a class="reference internal" href="w90_interface.html#orbital-order-in-the-w90-converter">orbital order in the W90 converter</a></li>
</ul>
</li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Interface to VASP</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#general-remarks">General remarks</a></li>
<li class="toctree-l4"><a class="reference internal" href="#locproj-bug-for-individual-projections">LOCPROJ bug for individual projections:</a></li>
<li class="toctree-l4"><a class="reference internal" href="#convergence-of-projectors-with-vasp">convergence of projectors with Vasp</a></li>
<li class="toctree-l4"><a class="reference internal" href="#enabling-csc-calculations-with-wannier90-projectors">Enabling CSC calculations with Wannier90 projectors</a></li>
<li class="toctree-l4"><a class="reference internal" href="#speeding-up-by-not-writing-projectors-at-every-step">Speeding up by not writing projectors at every step</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../cRPA_VASP/README.html">How to do cRPA calculations with VASP</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../cRPA_VASP/README.html#file-description">file description</a></li>
<li class="toctree-l4"><a class="reference internal" href="../cRPA_VASP/README.html#workflow">Workflow:</a></li>
<li class="toctree-l4"><a class="reference internal" href="../cRPA_VASP/README.html#important-flags">important flags:</a></li>
<li class="toctree-l4"><a class="reference internal" href="../cRPA_VASP/README.html#convergency-tests">convergency tests:</a></li>
<li class="toctree-l4"><a class="reference internal" href="../cRPA_VASP/README.html#parameterization-of-u-and-j-from-crpa-calculations">Parameterization of U and J from cRPA calculations</a></li>
<li class="toctree-l4"><a class="reference internal" href="../cRPA_VASP/README.html#general-sidemarks">general sidemarks:</a></li>
<li class="toctree-l4"><a class="reference internal" href="../cRPA_VASP/README.html#version-and-compilation">version and compilation:</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../documentation.html#input-output">Input/Output</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../input_output/DMFT_input/input.html">Input</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../input_output/DMFT_input/general.html">[general]: General parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="../input_output/DMFT_input/solver.html">[solver]: solver specific parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="../input_output/DMFT_input/dft.html">[dft]: DFT related inputs</a></li>
<li class="toctree-l4"><a class="reference internal" href="../input_output/DMFT_input/advanced.html">[advanced]: Advanced inputs</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../input_output/DMFT_output/results.html">Output / results</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../input_output/DMFT_output/results.html#group-structure">Group structure</a></li>
<li class="toctree-l4"><a class="reference internal" href="../input_output/DMFT_output/results.html#subgroups">Subgroups</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../documentation.html#further-details-for-running">Further details for running</a><ul>
<li class="toctree-l3"><a class="reference internal" href="docker.html">Docker</a><ul>
<li class="toctree-l4"><a class="reference internal" href="docker.html#building-the-docker-image">Building the docker image</a></li>
<li class="toctree-l4"><a class="reference internal" href="docker.html#pulling-a-docker-image">Pulling a docker image</a></li>
<li class="toctree-l4"><a class="reference internal" href="docker.html#getting-docker-images-onto-cscs-daint">Getting docker images onto CSCS daint</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="run_locally.html">Run on your machine</a><ul>
<li class="toctree-l4"><a class="reference internal" href="run_locally.html#csc-calculations-locally">CSC calculations locally</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="run_cluster.html">Running solid_dmft on a cluster</a><ul>
<li class="toctree-l4"><a class="reference internal" href="run_cluster.html#running-on-cscs-daint">Running on CSCS daint</a></li>
<li class="toctree-l4"><a class="reference internal" href="run_cluster.html#one-shot-job-on-daint">one shot job on daint</a></li>
<li class="toctree-l4"><a class="reference internal" href="run_cluster.html#csc-calculations-on-daint">CSC calculations on daint</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../documentation.html#module-reference-manual">Module reference manual</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../_ref/csc_flow.html">csc_flow</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_ref/dft_managers.html">dft_managers</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../_ref/dft_managers.mpi_helpers.html">dft_managers.mpi_helpers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../_ref/dft_managers.qe_manager.html">dft_managers.qe_manager</a></li>
<li class="toctree-l4"><a class="reference internal" href="../_ref/dft_managers.vasp_manager.html">dft_managers.vasp_manager</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../_ref/dmft_cycle.html">dmft_cycle</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_ref/dmft_tools.html">dmft_tools</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../_ref/dmft_tools.afm_mapping.html">dmft_tools.afm_mapping</a></li>
<li class="toctree-l4"><a class="reference internal" href="../_ref/dmft_tools.convergence.html">dmft_tools.convergence</a></li>
<li class="toctree-l4"><a class="reference internal" href="../_ref/dmft_tools.formatter.html">dmft_tools.formatter</a></li>
<li class="toctree-l4"><a class="reference internal" href="../_ref/dmft_tools.greens_functions_mixer.html">dmft_tools.greens_functions_mixer</a></li>
<li class="toctree-l4"><a class="reference internal" href="../_ref/dmft_tools.initial_self_energies.html">dmft_tools.initial_self_energies</a></li>
<li class="toctree-l4"><a class="reference internal" href="../_ref/dmft_tools.interaction_hamiltonian.html">dmft_tools.interaction_hamiltonian</a></li>
<li class="toctree-l4"><a class="reference internal" href="../_ref/dmft_tools.legendre_filter.html">dmft_tools.legendre_filter</a></li>
<li class="toctree-l4"><a class="reference internal" href="../_ref/dmft_tools.manipulate_chemical_potential.html">dmft_tools.manipulate_chemical_potential</a></li>
<li class="toctree-l4"><a class="reference internal" href="../_ref/dmft_tools.matheval.html">dmft_tools.matheval</a></li>
<li class="toctree-l4"><a class="reference internal" href="../_ref/dmft_tools.observables.html">dmft_tools.observables</a></li>
<li class="toctree-l4"><a class="reference internal" href="../_ref/dmft_tools.results_to_archive.html">dmft_tools.results_to_archive</a></li>
<li class="toctree-l4"><a class="reference internal" href="../_ref/dmft_tools.solver.html">dmft_tools.solver</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../_ref/io_tools.html">io_tools</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../_ref/io_tools.dict_to_h5.html">io_tools.dict_to_h5</a></li>
<li class="toctree-l4"><a class="reference internal" href="../_ref/io_tools.postproc_toml_dict.html">io_tools.postproc_toml_dict</a></li>
<li class="toctree-l4"><a class="reference internal" href="../_ref/io_tools.verify_input_params.html">io_tools.verify_input_params</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../_ref/postprocessing.html">postprocessing</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../_ref/postprocessing.eval_U_cRPA_RESPACK.html">postprocessing.eval_U_cRPA_RESPACK</a></li>
<li class="toctree-l4"><a class="reference internal" href="../_ref/postprocessing.eval_U_cRPA_Vasp.html">postprocessing.eval_U_cRPA_Vasp</a></li>
<li class="toctree-l4"><a class="reference internal" href="../_ref/postprocessing.maxent_gf_imp.html">postprocessing.maxent_gf_imp</a></li>
<li class="toctree-l4"><a class="reference internal" href="../_ref/postprocessing.maxent_gf_latt.html">postprocessing.maxent_gf_latt</a></li>
<li class="toctree-l4"><a class="reference internal" href="../_ref/postprocessing.maxent_sigma.html">postprocessing.maxent_sigma</a></li>
<li class="toctree-l4"><a class="reference internal" href="../_ref/postprocessing.pade_sigma.html">postprocessing.pade_sigma</a></li>
<li class="toctree-l4"><a class="reference internal" href="../_ref/postprocessing.plot_correlated_bands.html">postprocessing.plot_correlated_bands</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../_ref/util.html">util</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../_ref/util.symmetrize_gamma_file.html">util.symmetrize_gamma_file</a></li>
<li class="toctree-l4"><a class="reference internal" href="../_ref/util.write_kslice_to_h5.html">util.write_kslice_to_h5</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials.html">Tutorials</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/SVO_os_qe/tutorial.html">1. OS with QE/W90 and cthyb: SrVO3 MIT</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/SVO_os_qe/tutorial.html#1.-Starting-out-with-DMFT">1. Starting out with DMFT</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/SVO_os_qe/tutorial.html#2.-Looking-at-the-Metal-Insulator-Transition">2. Looking at the Metal-Insulator Transition</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/SVO_os_qe/tutorial.html#3.-Refining-the-diagram">3. Refining the diagram</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/SVO_os_qe/tutorial.html#4.-Plotting-the-spectral-function">4. Plotting the spectral function</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/SVO_os_qe/tutorial.html#5-Visualizing-the-MIT">5 Visualizing the MIT</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/PrNiO3_csc_vasp_plo_cthyb/tutorial.html">2. CSC with VASP PLOs: charge order in PrNiO3</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/PrNiO3_csc_vasp_plo_cthyb/tutorial.html#1.-Running-the-initial-scf-DFT-calculation">1. Running the initial scf DFT calculation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/PrNiO3_csc_vasp_plo_cthyb/tutorial.html#2.-Running-the-CSC-DMFT-calculations">2. Running the CSC DMFT calculations</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/PrNiO3_csc_vasp_plo_cthyb/tutorial.html#Input-files-for-CSC-DMFT-calculations">Input files for CSC DMFT calculations</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/PrNiO3_csc_vasp_plo_cthyb/tutorial.html#Starting-the-calculations">Starting the calculations</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/PrNiO3_csc_vasp_plo_cthyb/tutorial.html#Analyzing-the-projectors">Analyzing the projectors</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/PrNiO3_csc_vasp_plo_cthyb/tutorial.html#3.-Plotting-the-results:-observables">3. Plotting the results: observables</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/PrNiO3_csc_vasp_plo_cthyb/tutorial.html#4.-Plotting-the-results:-the-Legendre-Green’s-function">4. Plotting the results: the Legendre Green’s function</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/PrNiO3_csc_vasp_plo_cthyb/tutorial.html#5.-Next-steps-to-try">5. Next steps to try</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/Ce2O3_csc_w90/tutorial.html">3. CSC with QE/W90 and HubbardI: total energy in Ce2O3</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/Ce2O3_csc_w90/tutorial.html#1.-Input-file-preparation">1. Input file preparation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/Ce2O3_csc_w90/tutorial.html#DFT-files">DFT files</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/Ce2O3_csc_w90/tutorial.html#DMFT">DMFT</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/Ce2O3_csc_w90/tutorial.html#2.-Running-DFT+DMFT">2. Running DFT+DMFT</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/Ce2O3_csc_w90/tutorial.html#3.-Non-interacting-Hamiltonian-and-convergence-analysis">3. Non-interacting Hamiltonian and convergence analysis</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/Ce2O3_csc_w90/tutorial.html#Tight-binding-Hamiltonian">Tight-binding Hamiltonian</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/Ce2O3_csc_w90/tutorial.html#Convergence">Convergence</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/NNO_os_plo_mag/tutorial.html">4. OS with VASP/PLOs and cthyb: AFM state of NdNiO2</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/NNO_os_plo_mag/tutorial.html#1.-Run-DFT">1. Run DFT</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/NNO_os_plo_mag/tutorial.html#2.-Creating-the-hdf5-archive-/-DMFT-input">2. Creating the hdf5 archive / DMFT input</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/NNO_os_plo_mag/tutorial.html#3.-Running-the-AFM-calculation">3. Running the AFM calculation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/NNO_os_plo_mag/tutorial.html#5.-Multiplet-analysis">5. Multiplet analysis</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/correlated_bandstructure/plot_correlated_bands.html">5. Plotting the spectral function</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/correlated_bandstructure/plot_correlated_bands.html#1.-Configuration">1. Configuration</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/correlated_bandstructure/plot_correlated_bands.html#Basic-options">Basic options</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/correlated_bandstructure/plot_correlated_bands.html#Wannier90">Wannier90</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/correlated_bandstructure/plot_correlated_bands.html#BZ-configuration">BZ configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/correlated_bandstructure/plot_correlated_bands.html#Self-energy">Self-energy</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/correlated_bandstructure/plot_correlated_bands.html#Plotting-options">Plotting options</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/correlated_bandstructure/plot_correlated_bands.html#2.-Run-and-Plotting">2. Run and Plotting</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../issues.html">Support &amp; contribute</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../issues.html#seeking-help">Seeking help</a></li>
<li class="toctree-l2"><a class="reference internal" href="../issues.html#improving-solid-dmft">Improving solid_dmft</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../issues.html#reporting-issues">Reporting issues</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../ChangeLog.html">Changelog</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../ChangeLog.html#version-3-2-0">Version 3.2.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ChangeLog.html#general">General</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ChangeLog.html#fix">fix</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ChangeLog.html#build">build</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ChangeLog.html#feat">feat</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ChangeLog.html#doc">doc</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ChangeLog.html#test">test</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ChangeLog.html#version-3-1-5">Version 3.1.5</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ChangeLog.html#version-3-1-4">Version 3.1.4</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ChangeLog.html#version-3-1-3">Version 3.1.3</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ChangeLog.html#version-3-1-2">Version 3.1.2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ChangeLog.html#version-3-1-1">Version 3.1.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ChangeLog.html#version-3-1-0">Version 3.1.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ChangeLog.html#version-3-0-0">Version 3.0.0</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #7E588A" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">solid_dmft</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../documentation.html">Documentation</a> &raquo;</li>
      <li>Interface to VASP</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/md_notes/vasp_csc.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="tex2jax_ignore mathjax_ignore section" id="interface-to-vasp">
<h1>Interface to VASP<a class="headerlink" href="#interface-to-vasp" title="Permalink to this headline"></a></h1>
<div class="section" id="general-remarks">
<h2>General remarks<a class="headerlink" href="#general-remarks" title="Permalink to this headline"></a></h2>
<p>One can use the official Vasp 5.4.4 patch 1 version with a few modifications:</p>
<ul class="simple">
<li>there is a bug in <code class="docutils literal notranslate"><span class="pre">fileio.F</span></code> around line 1710 where the code tries print out something like “reading the density matrix from Gamma”, but this should be done only by the master node. Adding a <code class="docutils literal notranslate"><span class="pre">IF</span> <span class="pre">(IO%IU0&gt;=0)</span> <span class="pre">THEN</span> <span class="pre">...</span> <span class="pre">ENDIF</span></code> around it fixes this</li>
<li>in the current version of the dft_tools interface the file <code class="docutils literal notranslate"><span class="pre">LOCPROJ</span></code> should contain the fermi energy in the header. Therefore  one should replace the following line in <code class="docutils literal notranslate"><span class="pre">locproj.F</span></code>:</li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">WRITE</span><span class="p">(</span><span class="mi">99</span><span class="p">,</span><span class="s1">&#39;(4I6,&quot;  # of spin, # of k-points, # of bands, # of proj&quot; )&#39;</span><span class="p">)</span> <span class="n">NS</span><span class="p">,</span><span class="n">NK</span><span class="p">,</span><span class="n">NB</span><span class="p">,</span><span class="n">NF</span>
</pre></div>
</div>
<p>by</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">WRITE</span><span class="p">(</span><span class="mi">99</span><span class="p">,</span><span class="s1">&#39;(4I6,F12.7,&quot;  # of spin, # of k-points, # of bands, # of proj, Efermi&quot; )&#39;</span><span class="p">)</span> <span class="n">W</span><span class="o">%</span><span class="n">WDES</span><span class="o">%</span><span class="n">NCDIJ</span><span class="p">,</span><span class="n">NK</span><span class="p">,</span><span class="n">NB</span><span class="p">,</span><span class="n">NF</span><span class="p">,</span><span class="n">EFERMI</span>
</pre></div>
</div>
<p>and add the variable <code class="docutils literal notranslate"><span class="pre">EFERMI</span></code> accordingly in the function call.</p>
<ul class="simple">
<li>Vasp gets sometimes stuck and does not write the <code class="docutils literal notranslate"><span class="pre">OSZICAR</span></code> file correctly due to a stuck buffer. Adding a flush to the buffer to have a correctly written <code class="docutils literal notranslate"><span class="pre">OSZICAR</span></code> to extract the DFT energy helps, by adding in <code class="docutils literal notranslate"><span class="pre">electron.F</span></code> around line 580 after</li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CALL</span> <span class="n">STOP_TIMING</span><span class="p">(</span><span class="s2">&quot;G&quot;</span><span class="p">,</span><span class="n">IO</span><span class="o">%</span><span class="n">IU6</span><span class="p">,</span><span class="s2">&quot;DOS&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>two lines:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">flush</span><span class="p">(</span><span class="mi">17</span><span class="p">)</span>
<span class="nb">print</span> <span class="o">*</span><span class="p">,</span> <span class="s1">&#39; &#39;</span>
</pre></div>
</div>
<ul class="simple">
<li>this one is <strong>essential</strong> for the current version of the DMFT code. Vasp spends a very long time in the function <code class="docutils literal notranslate"><span class="pre">LPRJ_LDApU</span></code> and this function is not needed! It is used for some basic checks and a manual LDA+U implementation. Removing the call to this function in <code class="docutils literal notranslate"><span class="pre">electron.F</span></code> in line 644 speeds up the calculation by up to 30%! If this is not done, Vasp will create a GAMMA file each iteration which needs to be removed manually to not overwrite the DMFT GAMMA file!</li>
<li>make sure that mixing in VASP stays turned on. Don’t set IMIX or the DFT steps won’t converge!</li>
</ul>
</div>
<div class="section" id="locproj-bug-for-individual-projections">
<h2>LOCPROJ bug for individual projections:<a class="headerlink" href="#locproj-bug-for-individual-projections" title="Permalink to this headline"></a></h2>
<p>Example use of LOCPROJ for t2g manifold of SrVO3 (the order of the orbitals seems to be mixed up… this example leads to x^2 -y^2, z^2, yz… )
In the current version there is some mix up in the mapping between selected orbitals in the INCAR and actual selected in the LOCPROJ. This is
what the software does (left side is INCAR, right side is resulting in the LOCPROJ)</p>
<ul class="simple">
<li>xy -&gt; x2-y2</li>
<li>yz -&gt; z2</li>
<li>xz -&gt; yz</li>
<li>x2-y2 -&gt; xz</li>
<li>z2 -&gt; xy</li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">LOCPROJ</span> <span class="o">=</span> <span class="mi">2</span> <span class="p">:</span> <span class="n">dxz</span> <span class="p">:</span> <span class="n">Pr</span> <span class="mi">1</span>
<span class="n">LOCPROJ</span> <span class="o">=</span> <span class="mi">2</span> <span class="p">:</span> <span class="n">dx2</span><span class="o">-</span><span class="n">y2</span> <span class="p">:</span> <span class="n">Pr</span> <span class="mi">1</span>
<span class="n">LOCPROJ</span> <span class="o">=</span> <span class="mi">2</span> <span class="p">:</span> <span class="n">dz2</span> <span class="p">:</span> <span class="n">Pr</span> <span class="mi">1</span>
</pre></div>
</div>
<p>However, if the complete d manifold is chosen, the usual VASP order (xy, yz, z2, xz, x2-y2) is obtained in the LOCPROJ. This is done as shown below</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">LOCPROJ</span> <span class="o">=</span> <span class="mi">2</span> <span class="p">:</span> <span class="n">d</span> <span class="p">:</span> <span class="n">Pr</span> <span class="mi">1</span>
</pre></div>
</div>
</div>
<div class="section" id="convergence-of-projectors-with-vasp">
<h2>convergence of projectors with Vasp<a class="headerlink" href="#convergence-of-projectors-with-vasp" title="Permalink to this headline"></a></h2>
<p>for a good convergence of the projectors it is important to convergence the wavefunctions to high accuracy. Otherwise this often leads to off-diagonal elements in the the local Green’s function. To check convergence pay attention to the rms and rms© values in the Vasp output. The former specifies the convergence of the KS wavefunction and the latter is difference of the input and out charge density. Note, this does not necessarily coincide with good convergence of the total energy in DFT! Here an example of two calculations for the same system, both converged down to <code class="docutils literal notranslate"><span class="pre">EDIFF=</span> <span class="pre">1E-10</span></code> and Vasp stopped. First run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>       <span class="n">N</span>       <span class="n">E</span>                     <span class="n">dE</span>             <span class="n">d</span> <span class="n">eps</span>       <span class="n">ncg</span>     <span class="n">rms</span>          <span class="n">rms</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
<span class="o">...</span>
<span class="n">DAV</span><span class="p">:</span>  <span class="mi">25</span>    <span class="o">-</span><span class="mf">0.394708006287E+02</span>   <span class="o">-</span><span class="mf">0.65893E-09</span>   <span class="o">-</span><span class="mf">0.11730E-10</span> <span class="mi">134994</span>   <span class="mf">0.197E-06</span>  <span class="mf">0.992E-05</span>
<span class="o">...</span>
</pre></div>
</div>
<p>second run with different smearing:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">...</span>
<span class="n">DAV</span><span class="p">:</span>  <span class="mi">31</span>    <span class="o">-</span><span class="mf">0.394760088659E+02</span>    <span class="mf">0.39472E-09</span>    <span class="mf">0.35516E-13</span> <span class="mi">132366</span>   <span class="mf">0.110E-10</span>  <span class="mf">0.245E-10</span>
<span class="o">...</span>
</pre></div>
</div>
<p>The total energy is lower as well. But more importantly the second calculation produces well converged projectors preserving symmetries way better, with less off-diagonal elements in Gloc, making it way easier for the solver. Always pay attention to rms.</p>
</div>
<div class="section" id="enabling-csc-calculations-with-wannier90-projectors">
<h2>Enabling CSC calculations with Wannier90 projectors<a class="headerlink" href="#enabling-csc-calculations-with-wannier90-projectors" title="Permalink to this headline"></a></h2>
<p>You basically only need to add two things to have W90 run in Vasp’s CSC mode, all in <code class="docutils literal notranslate"><span class="pre">electron.F</span></code>:</p>
<ul class="simple">
<li>the line <code class="docutils literal notranslate"><span class="pre">USE</span> <span class="pre">mlwf</span></code> at the top of the <code class="docutils literal notranslate"><span class="pre">SUBROUTINE</span> <span class="pre">ELMIN</span></code> together with all the other <code class="docutils literal notranslate"><span class="pre">USE</span> <span class="pre">...</span></code> statements.</li>
<li>right below where you removed the call to <code class="docutils literal notranslate"><span class="pre">LPRJ_LDApU</span></code> (see above, around line 650), there is the line <code class="docutils literal notranslate"><span class="pre">CALL</span> <span class="pre">LPRJ_DEALLOC_COVL</span></code>. Just add the following block right below, inside the same “if” as the <code class="docutils literal notranslate"><span class="pre">CALL</span> <span class="pre">LPRJ_DEALLOC_COVL</span></code>:</li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">IF</span> <span class="p">(</span><span class="n">WANNIER90</span><span class="p">())</span> <span class="n">THEN</span>
   <span class="n">CALL</span> <span class="n">KPAR_SYNC_ALL</span><span class="p">(</span><span class="n">WDES</span><span class="p">,</span><span class="n">W</span><span class="p">)</span>
   <span class="n">CALL</span> <span class="n">MLWF_WANNIER90</span><span class="p">(</span><span class="n">WDES</span><span class="p">,</span><span class="n">W</span><span class="p">,</span><span class="n">P</span><span class="p">,</span><span class="n">CQIJ</span><span class="p">,</span><span class="n">T_INFO</span><span class="p">,</span><span class="n">LATT_CUR</span><span class="p">,</span><span class="n">INFO</span><span class="p">,</span><span class="n">IO</span><span class="p">)</span>
<span class="n">ENDIF</span>
</pre></div>
</div>
<p>Then, the only problem you’ll have is the order of compilation in the <code class="docutils literal notranslate"><span class="pre">.objects</span></code> file. It has to change because now electron.F references mlwf. For that move the entries <code class="docutils literal notranslate"><span class="pre">twoelectron4o.o</span></code> and <code class="docutils literal notranslate"><span class="pre">mlwf.o</span></code> (in this order) up right behind <code class="docutils literal notranslate"><span class="pre">linear_optics.o</span></code>. Then, move the lines from <code class="docutils literal notranslate"><span class="pre">electron.o</span></code> to <code class="docutils literal notranslate"><span class="pre">stm.o</span></code> behind the new position of <code class="docutils literal notranslate"><span class="pre">mlwf.o</span></code>.</p>
<p>Remarks:</p>
<ul class="simple">
<li>W90-CSC requires Wannier90 v3, in v2 the tag write_u_matrices does not work correctly. Until now, linking W90 v3 to Vasp with the <code class="docutils literal notranslate"><span class="pre">DVASP2WANNIER90v2</span></code> has worked without any problems even though it is not officially supported</li>
<li>symmetries in Vasp should remain turned on, otherwise the determination of rotation matrices in dft_tools’ wannier converter will most likely fail</li>
</ul>
</div>
<div class="section" id="speeding-up-by-not-writing-projectors-at-every-step">
<h2>Speeding up by not writing projectors at every step<a class="headerlink" href="#speeding-up-by-not-writing-projectors-at-every-step" title="Permalink to this headline"></a></h2>
<p>This is very important for CSC calculations with W90 but also speeds up the PLO-based ones.</p>
<p>Writing the Wannier projectors is a time consuming step (and to a lesser extent, the PLO projectors) and basically needs only to be done in the DFT iteration right before a DMFT iteration. Therefore, solid_dmft writes the file <code class="docutils literal notranslate"><span class="pre">vasp.suppress_projs</span></code> that tells Vasp when <strong>not</strong> to compute/write the projectors. This requires two small changes in <code class="docutils literal notranslate"><span class="pre">electron.F</span></code> in the Vasp source code:</p>
<ul class="simple">
<li>adding the definition of a logical variable where all other variables are defined for <code class="docutils literal notranslate"><span class="pre">SUBROUTINE</span> <span class="pre">ELMIN</span></code>, e.g. around line 150, by inserting <code class="docutils literal notranslate"><span class="pre">LOGICAL</span> <span class="pre">::</span> <span class="pre">LSUPPRESS_PROJS_EXISTS</span></code></li>
<li>go to the place where you removed the call to <code class="docutils literal notranslate"><span class="pre">LPRJ_LDApU</span></code> (see above, around line 650). This is inside a <code class="docutils literal notranslate"><span class="pre">IF</span> <span class="pre">(MOD(INFO%ICHARG,10)==5)</span> <span class="pre">THEN</span> <span class="pre">...</span> <span class="pre">ENDIF</span></code> block. This whole block has to be disabled when the file <code class="docutils literal notranslate"><span class="pre">vasp.suppress_projs</span></code> exists. So, right under this block’s “IF”, add the lines</li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">INQUIRE</span><span class="p">(</span><span class="n">FILE</span><span class="o">=</span><span class="s1">&#39;vasp.suppress_projs&#39;</span><span class="p">,</span><span class="o">&amp;</span>
        <span class="n">EXIST</span><span class="o">=</span><span class="n">LSUPPRESS_PROJS_EXISTS</span><span class="p">)</span>

<span class="n">IF</span> <span class="p">(</span><span class="o">.</span><span class="n">NOT</span><span class="o">.</span> <span class="n">LSUPPRESS_PROJS_EXISTS</span><span class="p">)</span> <span class="n">THEN</span>
</pre></div>
</div>
<p>and right before this block’s “ENDIF”, add another <code class="docutils literal notranslate"><span class="pre">ENDIF</span></code>.</p>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="w90_interface.html" class="btn btn-neutral float-left" title="Wannier90 interface" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../cRPA_VASP/README.html" class="btn btn-neutral float-right" title="How to do cRPA calculations with VASP" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright Copyright (C) 2018-2020, ETH Zurich Copyright (C) 2021-2022, The Simons Foundation authors: A. Hampel, M. Merkel, A. Carta, and S. Beck.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>