<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>4. OS with VASP/PLOs and cthyb: AFM state of NdNiO2 &mdash; solid_dmft  documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/custom.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/plot_directive.css" type="text/css" />
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script defer="defer" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=default"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="5. Plotting the spectral function" href="../correlated_bandstructure/plot_correlated_bands.html" />
    <link rel="prev" title="3. CSC with QE/W90 and HubbardI: total energy in Ce2O3" href="../Ce2O3_csc_w90/tutorial.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #7E588A" >
            <a href="../../index.html" class="icon icon-home"> solid_dmft
            <img src="../../_static/logo_no_text.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                3.2.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../install.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../install.html#prerequisites">Prerequisites</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../install.html#installation-via-pip">Installation via pip</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../install.html#manual-installation-via-cmake">Manual installation via CMake</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../install.html#docker-files-images">Docker files &amp; images</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../install.html#version-compatibility">Version compatibility</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../install.html#custom-cmake-options">Custom CMake options</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../documentation.html">Documentation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../documentation.html#code-structure">Code structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../documentation.html#dft-interface-notes">DFT interface notes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../md_notes/w90_interface.html">Wannier90 interface</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../md_notes/w90_interface.html#orbital-order-in-the-w90-converter">orbital order in the W90 converter</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../md_notes/vasp_csc.html">Interface to VASP</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../md_notes/vasp_csc.html#general-remarks">General remarks</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../md_notes/vasp_csc.html#locproj-bug-for-individual-projections">LOCPROJ bug for individual projections:</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../md_notes/vasp_csc.html#convergence-of-projectors-with-vasp">convergence of projectors with Vasp</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../md_notes/vasp_csc.html#enabling-csc-calculations-with-wannier90-projectors">Enabling CSC calculations with Wannier90 projectors</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../md_notes/vasp_csc.html#speeding-up-by-not-writing-projectors-at-every-step">Speeding up by not writing projectors at every step</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../cRPA_VASP/README.html">How to do cRPA calculations with VASP</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../cRPA_VASP/README.html#file-description">file description</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../cRPA_VASP/README.html#workflow">Workflow:</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../cRPA_VASP/README.html#important-flags">important flags:</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../cRPA_VASP/README.html#convergency-tests">convergency tests:</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../cRPA_VASP/README.html#parameterization-of-u-and-j-from-crpa-calculations">Parameterization of U and J from cRPA calculations</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../cRPA_VASP/README.html#general-sidemarks">general sidemarks:</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../cRPA_VASP/README.html#version-and-compilation">version and compilation:</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../documentation.html#input-output">Input/Output</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../input_output/DMFT_input/input.html">Input</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../input_output/DMFT_input/general.html">[general]: General parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../input_output/DMFT_input/solver.html">[solver]: solver specific parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../input_output/DMFT_input/dft.html">[dft]: DFT related inputs</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../input_output/DMFT_input/advanced.html">[advanced]: Advanced inputs</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../input_output/DMFT_output/results.html">Output / results</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../input_output/DMFT_output/results.html#group-structure">Group structure</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../input_output/DMFT_output/results.html#subgroups">Subgroups</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../documentation.html#further-details-for-running">Further details for running</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../md_notes/docker.html">Docker</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../md_notes/docker.html#building-the-docker-image">Building the docker image</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../md_notes/docker.html#pulling-a-docker-image">Pulling a docker image</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../md_notes/docker.html#getting-docker-images-onto-cscs-daint">Getting docker images onto CSCS daint</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../md_notes/run_locally.html">Run on your machine</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../md_notes/run_locally.html#csc-calculations-locally">CSC calculations locally</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../md_notes/run_cluster.html">Running solid_dmft on a cluster</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../md_notes/run_cluster.html#running-on-cscs-daint">Running on CSCS daint</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../md_notes/run_cluster.html#one-shot-job-on-daint">one shot job on daint</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../md_notes/run_cluster.html#csc-calculations-on-daint">CSC calculations on daint</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../documentation.html#module-reference-manual">Module reference manual</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../_ref/csc_flow.html">csc_flow</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../_ref/dft_managers.html">dft_managers</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../_ref/dft_managers.mpi_helpers.html">dft_managers.mpi_helpers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_ref/dft_managers.qe_manager.html">dft_managers.qe_manager</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_ref/dft_managers.vasp_manager.html">dft_managers.vasp_manager</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../_ref/dmft_cycle.html">dmft_cycle</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../_ref/dmft_tools.html">dmft_tools</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../_ref/dmft_tools.afm_mapping.html">dmft_tools.afm_mapping</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_ref/dmft_tools.convergence.html">dmft_tools.convergence</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_ref/dmft_tools.formatter.html">dmft_tools.formatter</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_ref/dmft_tools.greens_functions_mixer.html">dmft_tools.greens_functions_mixer</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_ref/dmft_tools.initial_self_energies.html">dmft_tools.initial_self_energies</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_ref/dmft_tools.interaction_hamiltonian.html">dmft_tools.interaction_hamiltonian</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_ref/dmft_tools.legendre_filter.html">dmft_tools.legendre_filter</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_ref/dmft_tools.manipulate_chemical_potential.html">dmft_tools.manipulate_chemical_potential</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_ref/dmft_tools.matheval.html">dmft_tools.matheval</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_ref/dmft_tools.observables.html">dmft_tools.observables</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_ref/dmft_tools.results_to_archive.html">dmft_tools.results_to_archive</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_ref/dmft_tools.solver.html">dmft_tools.solver</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../_ref/io_tools.html">io_tools</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../_ref/io_tools.dict_to_h5.html">io_tools.dict_to_h5</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_ref/io_tools.postproc_toml_dict.html">io_tools.postproc_toml_dict</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_ref/io_tools.verify_input_params.html">io_tools.verify_input_params</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../_ref/postprocessing.html">postprocessing</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../_ref/postprocessing.eval_U_cRPA_RESPACK.html">postprocessing.eval_U_cRPA_RESPACK</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_ref/postprocessing.eval_U_cRPA_Vasp.html">postprocessing.eval_U_cRPA_Vasp</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_ref/postprocessing.maxent_gf_imp.html">postprocessing.maxent_gf_imp</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_ref/postprocessing.maxent_gf_latt.html">postprocessing.maxent_gf_latt</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_ref/postprocessing.maxent_sigma.html">postprocessing.maxent_sigma</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_ref/postprocessing.pade_sigma.html">postprocessing.pade_sigma</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_ref/postprocessing.plot_correlated_bands.html">postprocessing.plot_correlated_bands</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../_ref/util.html">util</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../_ref/util.symmetrize_gamma_file.html">util.symmetrize_gamma_file</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_ref/util.write_kslice_to_h5.html">util.write_kslice_to_h5</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../../tutorials.html">Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../SVO_os_qe/tutorial.html">1. OS with QE/W90 and cthyb: SrVO3 MIT</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../SVO_os_qe/tutorial.html#1.-Starting-out-with-DMFT">1. Starting out with DMFT</a></li>
<li class="toctree-l3"><a class="reference internal" href="../SVO_os_qe/tutorial.html#2.-Looking-at-the-Metal-Insulator-Transition">2. Looking at the Metal-Insulator Transition</a></li>
<li class="toctree-l3"><a class="reference internal" href="../SVO_os_qe/tutorial.html#3.-Refining-the-diagram">3. Refining the diagram</a></li>
<li class="toctree-l3"><a class="reference internal" href="../SVO_os_qe/tutorial.html#4.-Plotting-the-spectral-function">4. Plotting the spectral function</a></li>
<li class="toctree-l3"><a class="reference internal" href="../SVO_os_qe/tutorial.html#5-Visualizing-the-MIT">5 Visualizing the MIT</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../PrNiO3_csc_vasp_plo_cthyb/tutorial.html">2. CSC with VASP PLOs: charge order in PrNiO3</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../PrNiO3_csc_vasp_plo_cthyb/tutorial.html#1.-Running-the-initial-scf-DFT-calculation">1. Running the initial scf DFT calculation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../PrNiO3_csc_vasp_plo_cthyb/tutorial.html#2.-Running-the-CSC-DMFT-calculations">2. Running the CSC DMFT calculations</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../PrNiO3_csc_vasp_plo_cthyb/tutorial.html#Input-files-for-CSC-DMFT-calculations">Input files for CSC DMFT calculations</a></li>
<li class="toctree-l4"><a class="reference internal" href="../PrNiO3_csc_vasp_plo_cthyb/tutorial.html#Starting-the-calculations">Starting the calculations</a></li>
<li class="toctree-l4"><a class="reference internal" href="../PrNiO3_csc_vasp_plo_cthyb/tutorial.html#Analyzing-the-projectors">Analyzing the projectors</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../PrNiO3_csc_vasp_plo_cthyb/tutorial.html#3.-Plotting-the-results:-observables">3. Plotting the results: observables</a></li>
<li class="toctree-l3"><a class="reference internal" href="../PrNiO3_csc_vasp_plo_cthyb/tutorial.html#4.-Plotting-the-results:-the-Legendre-Green’s-function">4. Plotting the results: the Legendre Green’s function</a></li>
<li class="toctree-l3"><a class="reference internal" href="../PrNiO3_csc_vasp_plo_cthyb/tutorial.html#5.-Next-steps-to-try">5. Next steps to try</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../Ce2O3_csc_w90/tutorial.html">3. CSC with QE/W90 and HubbardI: total energy in Ce2O3</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../Ce2O3_csc_w90/tutorial.html#1.-Input-file-preparation">1. Input file preparation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../Ce2O3_csc_w90/tutorial.html#DFT-files">DFT files</a></li>
<li class="toctree-l4"><a class="reference internal" href="../Ce2O3_csc_w90/tutorial.html#DMFT">DMFT</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../Ce2O3_csc_w90/tutorial.html#2.-Running-DFT+DMFT">2. Running DFT+DMFT</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Ce2O3_csc_w90/tutorial.html#3.-Non-interacting-Hamiltonian-and-convergence-analysis">3. Non-interacting Hamiltonian and convergence analysis</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../Ce2O3_csc_w90/tutorial.html#Tight-binding-Hamiltonian">Tight-binding Hamiltonian</a></li>
<li class="toctree-l4"><a class="reference internal" href="../Ce2O3_csc_w90/tutorial.html#Convergence">Convergence</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">4. OS with VASP/PLOs and cthyb: AFM state of NdNiO2</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#1.-Run-DFT">1. Run DFT</a></li>
<li class="toctree-l3"><a class="reference internal" href="#2.-Creating-the-hdf5-archive-/-DMFT-input">2. Creating the hdf5 archive / DMFT input</a></li>
<li class="toctree-l3"><a class="reference internal" href="#3.-Running-the-AFM-calculation">3. Running the AFM calculation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#5.-Multiplet-analysis">5. Multiplet analysis</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../correlated_bandstructure/plot_correlated_bands.html">5. Plotting the spectral function</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../correlated_bandstructure/plot_correlated_bands.html#1.-Configuration">1. Configuration</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../correlated_bandstructure/plot_correlated_bands.html#Basic-options">Basic options</a></li>
<li class="toctree-l4"><a class="reference internal" href="../correlated_bandstructure/plot_correlated_bands.html#Wannier90">Wannier90</a></li>
<li class="toctree-l4"><a class="reference internal" href="../correlated_bandstructure/plot_correlated_bands.html#BZ-configuration">BZ configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="../correlated_bandstructure/plot_correlated_bands.html#Self-energy">Self-energy</a></li>
<li class="toctree-l4"><a class="reference internal" href="../correlated_bandstructure/plot_correlated_bands.html#Plotting-options">Plotting options</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../correlated_bandstructure/plot_correlated_bands.html#2.-Run-and-Plotting">2. Run and Plotting</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../issues.html">Support &amp; contribute</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../issues.html#seeking-help">Seeking help</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../issues.html#improving-solid-dmft">Improving solid_dmft</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../issues.html#reporting-issues">Reporting issues</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../ChangeLog.html">Changelog</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../ChangeLog.html#version-3-2-0">Version 3.2.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ChangeLog.html#general">General</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ChangeLog.html#fix">fix</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ChangeLog.html#build">build</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ChangeLog.html#feat">feat</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ChangeLog.html#doc">doc</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ChangeLog.html#test">test</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ChangeLog.html#version-3-1-5">Version 3.1.5</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ChangeLog.html#version-3-1-4">Version 3.1.4</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ChangeLog.html#version-3-1-3">Version 3.1.3</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ChangeLog.html#version-3-1-2">Version 3.1.2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ChangeLog.html#version-3-1-1">Version 3.1.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ChangeLog.html#version-3-1-0">Version 3.1.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ChangeLog.html#version-3-0-0">Version 3.0.0</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #7E588A" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">solid_dmft</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../../tutorials.html">Tutorials</a> &raquo;</li>
      <li>4. OS with VASP/PLOs and cthyb: AFM state of NdNiO2</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/tutorials/NNO_os_plo_mag/tutorial.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="n">np</span><span class="o">.</span><span class="n">set_printoptions</span><span class="p">(</span><span class="n">precision</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span><span class="n">suppress</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">triqs.plot.mpl_interface</span> <span class="kn">import</span> <span class="n">plt</span><span class="p">,</span><span class="n">oplot</span>

<span class="kn">from</span> <span class="nn">h5</span> <span class="kn">import</span> <span class="n">HDFArchive</span>

<span class="kn">from</span> <span class="nn">triqs_dft_tools.converters.vasp</span> <span class="kn">import</span> <span class="n">VaspConverter</span>
<span class="kn">import</span> <span class="nn">triqs_dft_tools.converters.plovasp.converter</span> <span class="k">as</span> <span class="nn">plo_converter</span>

<span class="kn">import</span> <span class="nn">pymatgen.io.vasp.outputs</span> <span class="k">as</span> <span class="nn">vio</span>
<span class="kn">from</span> <span class="nn">pymatgen.electronic_structure.dos</span> <span class="kn">import</span> <span class="n">CompleteDos</span>
<span class="kn">from</span> <span class="nn">pymatgen.electronic_structure.core</span> <span class="kn">import</span> <span class="n">Spin</span><span class="p">,</span> <span class="n">Orbital</span><span class="p">,</span> <span class="n">OrbitalType</span>

<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span> <span class="c1">#ignore some matplotlib warnings</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Warning: could not identify MPI environment!
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Starting serial run at: 2023-11-24 09:49:44.156139
</pre></div></div>
</div>
<div class="section" id="4.-OS-with-VASP/PLOs-and-cthyb:-AFM-state-of-NdNiO2">
<h1>4. OS with VASP/PLOs and cthyb: AFM state of NdNiO2<a class="headerlink" href="#4.-OS-with-VASP/PLOs-and-cthyb:-AFM-state-of-NdNiO2" title="Permalink to this headline"></a></h1>
<p>In this tutorial we will take a look at a magnetic DMFT calculation for NdNiO2 in the antiferromagnetic phase. NdNiO2 shows a clear AFM phase at lower temperatures in DFT+DMFT calculation. The calculations will be performed for a large energy window with all Ni-<span class="math notranslate nohighlight">\(d\)</span> orbitals treated as interacting with a density-density type interaction.</p>
<p>Disclaimer: the interaction values, results etc. might not be 100% physical and are only for demonstrative purposes!</p>
<p>This tutorial will guide you through the following steps:</p>
<ul class="simple">
<li>run a non-magnetic Vasp calculation for NdNiO2 with a two atom supercell allowing magnetic order</li>
<li>create projectors in a large energy window for all Ni-<span class="math notranslate nohighlight">\(d\)</span> orbitals and all O-<span class="math notranslate nohighlight">\(p\)</span> orbitals</li>
<li>create the hdf5 input via the Vasp converter for solid_dmft</li>
<li>run a AFM DMFT one-shot calculation</li>
<li>take a look at the output and analyse the multiplets of the Ni-d states</li>
</ul>
<p>Warning: the DMFT calculations here are very heavy requiring ~2500 core hours for the DMFT job.</p>
<p>We set a <code class="docutils literal notranslate"><span class="pre">path</span></code> variable here to the reference files, which should be changed when doing the actual calculations do the work directory:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">path</span> <span class="o">=</span> <span class="s1">&#39;./ref/&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="1.-Run-DFT">
<h2>1. Run DFT<a class="headerlink" href="#1.-Run-DFT" title="Permalink to this headline"></a></h2>
<p>We start by running Vasp to create the raw projectors. The <a class="reference external" href="INCAR" rel="noopener noreferrer" target="_blank">INCAR</a>, <a class="reference external" href="POSCAR" rel="noopener noreferrer" target="_blank">POSCAR</a>, and <a class="reference external" href="KPOINTS" rel="noopener noreferrer" target="_blank">KPOINTS</a> file are kept relatively simple. For the POTCAR the <code class="docutils literal notranslate"><span class="pre">PBE</span> <span class="pre">Nd_3</span></code>, <code class="docutils literal notranslate"><span class="pre">PBE</span> <span class="pre">Ni_pv</span></code> and <code class="docutils literal notranslate"><span class="pre">PBE</span> <span class="pre">O</span></code> pseudo potentials are used. Here we make sure that the Kohn-Sham eigenstates are well converged (rms), by performing a few extra SCF steps by setting <code class="docutils literal notranslate"><span class="pre">NELMIN=30</span></code>. Then, the INCAR flag <code class="docutils literal notranslate"><span class="pre">LOCPROJ</span> <span class="pre">=</span> <span class="pre">LOCPROJ</span> <span class="pre">=</span> <span class="pre">3</span> <span class="pre">4</span> <span class="pre">:</span> <span class="pre">d</span> <span class="pre">:</span> <span class="pre">Pr</span></code> instructs Vasp to create projectors for the Ni-<span class="math notranslate nohighlight">\(d\)</span>
shell of the two Ni sties. More information can be found on the <a class="reference external" href="https://triqs.github.io/dft_tools/unstable/guide/conv_vasp.html" rel="noopener noreferrer" target="_blank">DFTTools webpage of the Vasp converter</a>.</p>
<p>Next, run Vasp with</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>mpirun vasp_std 1&gt;out.vasp 2&gt;err.vasp &amp;
</pre></div>
</div>
<p>and monitor the output. After Vasp is finished the result should look like this:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">!</span>tail -n <span class="m">10</span> ref/out.vasp
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
DAV:  25    -0.569483098581E+02   -0.31832E-09    0.42131E-12 29952   0.148E-06    0.488E-07
DAV:  26    -0.569483098574E+02    0.75124E-09    0.25243E-12 30528   0.511E-07    0.226E-07
DAV:  27    -0.569483098574E+02   -0.12733E-10    0.17328E-12 28448   0.285E-07    0.826E-08
DAV:  28    -0.569483098578E+02   -0.41837E-09    0.17366E-12 29536   0.151E-07    0.370E-08
DAV:  29    -0.569483098576E+02    0.22192E-09    0.19300E-12 29280   0.689E-08    0.124E-08
DAV:  30    -0.569483098572E+02    0.38563E-09    0.27026E-12 28576   0.388E-08    0.598E-09
DAV:  31    -0.569483098573E+02   -0.92768E-10    0.34212E-12 29024   0.218E-08
 LOCPROJ mode
 Computing AMN (projections onto localized orbitals)
   1 F= -.56948310E+02 E0= -.56941742E+02  d E =-.131358E-01
</pre></div></div>
</div>
<p>let us take a look at the density of states from Vasp:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">vasprun</span> <span class="o">=</span> <span class="n">vio</span><span class="o">.</span><span class="n">Vasprun</span><span class="p">(</span><span class="n">path</span><span class="o">+</span><span class="s1">&#39;/vasprun.xml&#39;</span><span class="p">)</span>
<span class="n">dos</span> <span class="o">=</span> <span class="n">vasprun</span><span class="o">.</span><span class="n">complete_dos</span>
<span class="n">Ni_spd_dos</span> <span class="o">=</span> <span class="n">dos</span><span class="o">.</span><span class="n">get_element_spd_dos</span><span class="p">(</span><span class="s2">&quot;Ni&quot;</span><span class="p">)</span>
<span class="n">O_spd_dos</span> <span class="o">=</span> <span class="n">dos</span><span class="o">.</span><span class="n">get_element_spd_dos</span><span class="p">(</span><span class="s2">&quot;O&quot;</span><span class="p">)</span>
<span class="n">Nd_spd_dos</span> <span class="o">=</span> <span class="n">dos</span><span class="o">.</span><span class="n">get_element_spd_dos</span><span class="p">(</span><span class="s2">&quot;Nd&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>

<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">vasprun</span><span class="o">.</span><span class="n">tdos</span><span class="o">.</span><span class="n">energies</span> <span class="o">-</span> <span class="n">vasprun</span><span class="o">.</span><span class="n">efermi</span> <span class="p">,</span> <span class="n">vasprun</span><span class="o">.</span><span class="n">tdos</span><span class="o">.</span><span class="n">densities</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;total DOS&#39;</span><span class="p">,</span> <span class="n">lw</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">vasprun</span><span class="o">.</span><span class="n">tdos</span><span class="o">.</span><span class="n">energies</span> <span class="o">-</span> <span class="n">vasprun</span><span class="o">.</span><span class="n">efermi</span> <span class="p">,</span> <span class="n">Ni_spd_dos</span><span class="p">[</span><span class="n">OrbitalType</span><span class="o">.</span><span class="n">d</span><span class="p">]</span><span class="o">.</span><span class="n">densities</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;Ni-d&#39;</span><span class="p">,</span> <span class="n">lw</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">vasprun</span><span class="o">.</span><span class="n">tdos</span><span class="o">.</span><span class="n">energies</span> <span class="o">-</span> <span class="n">vasprun</span><span class="o">.</span><span class="n">efermi</span> <span class="p">,</span> <span class="n">O_spd_dos</span><span class="p">[</span><span class="n">OrbitalType</span><span class="o">.</span><span class="n">p</span><span class="p">]</span><span class="o">.</span><span class="n">densities</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;O-p&#39;</span><span class="p">,</span> <span class="n">lw</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">vasprun</span><span class="o">.</span><span class="n">tdos</span><span class="o">.</span><span class="n">energies</span> <span class="o">-</span> <span class="n">vasprun</span><span class="o">.</span><span class="n">efermi</span> <span class="p">,</span> <span class="n">Nd_spd_dos</span><span class="p">[</span><span class="n">OrbitalType</span><span class="o">.</span><span class="n">d</span><span class="p">]</span><span class="o">.</span><span class="n">densities</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;Nd-d&#39;</span><span class="p">,</span> <span class="n">lw</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Energy relative to Fermi energy (eV)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;DOS (1/eV)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mi">9</span><span class="p">,</span><span class="mf">8.5</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorials_NNO_os_plo_mag_tutorial_8_0.png" src="../../_images/tutorials_NNO_os_plo_mag_tutorial_8_0.png" />
</div>
</div>
<p>We see that the Ni-<span class="math notranslate nohighlight">\(d\)</span> states are entangled / hybridizing with O-<span class="math notranslate nohighlight">\(p\)</span> states and Nd-<span class="math notranslate nohighlight">\(d\)</span> states in the energy range between -9 and 9 eV. Hence, we orthonormalize our projectors considering all states in this energy window to create well localized real-space states. These projectors will be indeed quite similar to the internal DFT+<span class="math notranslate nohighlight">\(U\)</span> projectors used in VASP due to the large energy window.</p>
</div>
<div class="section" id="2.-Creating-the-hdf5-archive-/-DMFT-input">
<h2>2. Creating the hdf5 archive / DMFT input<a class="headerlink" href="#2.-Creating-the-hdf5-archive-/-DMFT-input" title="Permalink to this headline"></a></h2>
<p>Next we run the <a class="reference external" href="https://triqs.github.io/dft_tools/unstable/guide/conv_vasp.html" rel="noopener noreferrer" target="_blank">Vasp converter</a> to create an input h5 archive for solid_dmft. The <a class="reference external" href="plo.cfg" rel="noopener noreferrer" target="_blank">plo.cfg</a> looks like this:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">!</span>cat plo.cfg
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[General]
BASENAME = nno

[Group 1]
SHELLS = 1
NORMALIZE = True
NORMION = False
EWINDOW = -10 10

[Shell 1]
LSHELL = 2
IONS = 3 4
TRANSFORM = 0.0  0.0  0.0  0.0  1.0
            0.0  1.0  0.0  0.0  0.0
            0.0  0.0  1.0  0.0  0.0
            0.0  0.0  0.0  1.0  0.0
            1.0  0.0  0.0  0.0  0.0
</pre></div></div>
</div>
<p>we create <span class="math notranslate nohighlight">\(d\)</span> like projectors within a large energy window from -10 to 10 eV for very localized states for both Ni sites. Important: the sites are markes as non equivalent, so that we can later have different spin orientations on them. The flag <code class="docutils literal notranslate"><span class="pre">TRANSFORM</span></code> swaps the <span class="math notranslate nohighlight">\(d_{xy}\)</span> and <span class="math notranslate nohighlight">\(d_{x^2 - y^2}\)</span> orbitals, since the orientation in the unit cell of the oxygen bonds is rotated by 45 degreee. Vasp always performs projections in a global cartesian coordinate frame, so one has to
rotate the orbitals manually with the octahedra orientation.</p>
<p>Let’s run the converter:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Generate and store PLOs</span>
<span class="n">plo_converter</span><span class="o">.</span><span class="n">generate_and_output_as_text</span><span class="p">(</span><span class="s1">&#39;plo.cfg&#39;</span><span class="p">,</span> <span class="n">vasp_dir</span><span class="o">=</span><span class="n">path</span><span class="p">)</span>

<span class="c1"># run the archive creat routine</span>
<span class="n">conv</span> <span class="o">=</span> <span class="n">VaspConverter</span><span class="p">(</span><span class="s1">&#39;nno&#39;</span><span class="p">)</span>
<span class="n">conv</span><span class="o">.</span><span class="n">convert_dft_input</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Read parameters: LOCPROJ
0  -&gt;  {&#39;label&#39;: &#39;dxy&#39;, &#39;isite&#39;: 3, &#39;l&#39;: 2, &#39;m&#39;: 0}
1  -&gt;  {&#39;label&#39;: &#39;dyz&#39;, &#39;isite&#39;: 3, &#39;l&#39;: 2, &#39;m&#39;: 1}
2  -&gt;  {&#39;label&#39;: &#39;dz2&#39;, &#39;isite&#39;: 3, &#39;l&#39;: 2, &#39;m&#39;: 2}
3  -&gt;  {&#39;label&#39;: &#39;dxz&#39;, &#39;isite&#39;: 3, &#39;l&#39;: 2, &#39;m&#39;: 3}
4  -&gt;  {&#39;label&#39;: &#39;dx2-y2&#39;, &#39;isite&#39;: 3, &#39;l&#39;: 2, &#39;m&#39;: 4}
5  -&gt;  {&#39;label&#39;: &#39;dxy&#39;, &#39;isite&#39;: 4, &#39;l&#39;: 2, &#39;m&#39;: 0}
6  -&gt;  {&#39;label&#39;: &#39;dyz&#39;, &#39;isite&#39;: 4, &#39;l&#39;: 2, &#39;m&#39;: 1}
7  -&gt;  {&#39;label&#39;: &#39;dz2&#39;, &#39;isite&#39;: 4, &#39;l&#39;: 2, &#39;m&#39;: 2}
8  -&gt;  {&#39;label&#39;: &#39;dxz&#39;, &#39;isite&#39;: 4, &#39;l&#39;: 2, &#39;m&#39;: 3}
9  -&gt;  {&#39;label&#39;: &#39;dx2-y2&#39;, &#39;isite&#39;: 4, &#39;l&#39;: 2, &#39;m&#39;: 4}
  Found POSCAR, title line: NdNiO2 SC
  Total number of ions: 8
  Number of types: 3
  Number of ions for each type: [2, 2, 4]

    Total number of k-points: 405
  No tetrahedron data found in IBZKPT. Skipping...
[WARNING]: Error reading from EIGENVAL, trying LOCPROJ...
[WARNING]: Error reading Efermi from DOSCAR, trying LOCPROJ...
eigvals from LOCPROJ

  Unorthonormalized density matrices and overlaps:
  Spin: 1
  Site: 3
  Density matrix                                                  Overlap
   1.1544881   0.0000000  -0.0000000   0.0000000  -0.0000000       0.9626619  -0.0000000   0.0000000   0.0000002  -0.0000000
   0.0000000   1.7591058  -0.0000000   0.0000000  -0.0000000      -0.0000000   0.9464342  -0.0000000   0.0000000  -0.0000000
  -0.0000000  -0.0000000   1.5114185   0.0000000  -0.0000000       0.0000000  -0.0000000   0.9548582  -0.0000000   0.0000000
   0.0000000   0.0000000   0.0000000   1.7591058  -0.0000000       0.0000002   0.0000000  -0.0000000   0.9464339   0.0000000
  -0.0000000  -0.0000000  -0.0000000  -0.0000000   1.8114830      -0.0000000  -0.0000000   0.0000000   0.0000000   0.9495307
  Site: 4
  Density matrix                                                  Overlap
   1.1544881  -0.0000000   0.0000000   0.0000000   0.0000000       0.9626621   0.0000000  -0.0000000  -0.0000001  -0.0000000
  -0.0000000   1.7591058  -0.0000000  -0.0000000   0.0000000       0.0000000   0.9464343  -0.0000000  -0.0000000   0.0000000
   0.0000000  -0.0000000   1.5114185  -0.0000000  -0.0000000      -0.0000000  -0.0000000   0.9548582   0.0000000   0.0000000
   0.0000000  -0.0000000  -0.0000000   1.7591058   0.0000000      -0.0000001  -0.0000000   0.0000000   0.9464344   0.0000000
   0.0000000   0.0000000  -0.0000000   0.0000000   1.8114830      -0.0000000   0.0000000   0.0000000   0.0000000   0.9495307

  Generating 1 shell...

    Shell         : 1
    Orbital l     : 2
    Number of ions: 2
    Dimension     : 5
    Correlated    : True
    Ion sort      : [3, 4]
Density matrix:
  Shell 1
Site diag : True
    Site 1
     1.9468082    -0.0000000    -0.0000000     0.0000000    -0.0000000
    -0.0000000     1.8880488    -0.0000000     0.0000000     0.0000000
    -0.0000000    -0.0000000     1.5912192     0.0000000     0.0000000
     0.0000000     0.0000000     0.0000000     1.8880488     0.0000000
    -0.0000000     0.0000000     0.0000000     0.0000000     1.1979419
      trace:  8.512066911392091
    Site 2
     1.9468082     0.0000000    -0.0000000    -0.0000000    -0.0000000
     0.0000000     1.8880488    -0.0000000    -0.0000000    -0.0000000
    -0.0000000    -0.0000000     1.5912192    -0.0000000    -0.0000000
    -0.0000000    -0.0000000    -0.0000000     1.8880488    -0.0000000
    -0.0000000    -0.0000000    -0.0000000    -0.0000000     1.1979419
      trace:  8.512066911289741

  Impurity density: 17.024133822681833

Overlap:
  Site 1
[[ 1. -0. -0. -0. -0.]
 [-0.  1. -0. -0. -0.]
 [-0. -0.  1. -0. -0.]
 [-0. -0. -0.  1.  0.]
 [-0. -0. -0.  0.  1.]]

Local Hamiltonian:
  Shell 1
    Site 1 (real | complex part)
    -1.5179223     0.0000000     0.0000000    -0.0000000     0.0000000 |    -0.0000000    -0.0000000    -0.0000000    -0.0000000    -0.0000000
     0.0000000    -1.2888643     0.0000000    -0.0000000    -0.0000000 |     0.0000000     0.0000000    -0.0000000    -0.0000000    -0.0000000
     0.0000000     0.0000000    -0.9927644    -0.0000000    -0.0000000 |     0.0000000     0.0000000    -0.0000000     0.0000000     0.0000000
    -0.0000000    -0.0000000    -0.0000000    -1.2888643     0.0000000 |     0.0000000     0.0000000    -0.0000000     0.0000000     0.0000000
     0.0000000    -0.0000000    -0.0000000     0.0000000    -1.0828254 |     0.0000000     0.0000000    -0.0000000    -0.0000000     0.0000000
    Site 2 (real | complex part)
    -1.5179223    -0.0000000    -0.0000000    -0.0000000    -0.0000000 |     0.0000000     0.0000000    -0.0000000    -0.0000000    -0.0000000
    -0.0000000    -1.2888643     0.0000000    -0.0000000     0.0000000 |    -0.0000000    -0.0000000     0.0000000     0.0000000    -0.0000000
    -0.0000000     0.0000000    -0.9927644     0.0000000     0.0000000 |     0.0000000    -0.0000000     0.0000000    -0.0000000    -0.0000000
    -0.0000000    -0.0000000     0.0000000    -1.2888643     0.0000000 |     0.0000000    -0.0000000     0.0000000    -0.0000000     0.0000000
    -0.0000000     0.0000000     0.0000000     0.0000000    -1.0828254 |     0.0000000     0.0000000     0.0000000    -0.0000000     0.0000000
  Storing ctrl-file...
  Storing PLO-group file &#39;nno.pg1&#39;...
  Density within window: 42.00000000005771
Reading input from nno.ctrl...
{
    &#34;ngroups&#34;: 1,
    &#34;nk&#34;: 405,
    &#34;ns&#34;: 1,
    &#34;kvec1&#34;: [
        0.1803844533789928,
        0.0,
        0.0
    ],
    &#34;kvec2&#34;: [
        0.0,
        0.1803844533789928,
        0.0
    ],
    &#34;kvec3&#34;: [
        0.0,
        0.0,
        0.30211493941280826
    ],
    &#34;nc_flag&#34;: 0
}

  No. of inequivalent shells: 2
</pre></div></div>
</div>
<p>We can here cross check the quality of our projectors by making sure that there are not imaginary elements in both the local Hamiltonian and the density matrix. Furthermore, we see that the occupation of the Ni-<span class="math notranslate nohighlight">\(d\)</span> shell is roughly 8.5 electrons which is a bit different from the nominal charge of <span class="math notranslate nohighlight">\(d^9\)</span> for the system due to the large hybridization with the other states. For mor physical insights into the systems and a discussion on the appropriate choice of projectors see this
research article <a class="reference external" href="https://doi.org/10.1103/PhysRevB.103.195101" rel="noopener noreferrer" target="_blank">PRB 103 195101 2021</a></p>
</div>
<div class="section" id="3.-Running-the-AFM-calculation">
<h2>3. Running the AFM calculation<a class="headerlink" href="#3.-Running-the-AFM-calculation" title="Permalink to this headline"></a></h2>
<p>now we run the calculation at around 290 K, which should be below the ordering temperature of NdNiO2 in DMFT. The config file <a class="reference external" href="config.toml" rel="noopener noreferrer" target="_blank">config.toml</a> for solid_dmft looks like this:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[general]
seedname = &quot;nno&quot;
jobname = &quot;NNO_lowT&quot;

enforce_off_diag = false
block_threshold = 0.001


n_iw = 2001
n_tau = 20001

prec_mu = 0.001

h_int_type = &quot;density_density&quot;
U = 8.0
J = 1.0

# temperature ~290 K
beta = 40

magnetic = true
magmom = -0.3, 0.3
afm_order = true

n_iter_dmft = 14

g0_mix = 0.9

dc_type = 0
dc = true
dc_dmft = false

[solver]
type = &quot;cthyb&quot;
length_cycle = 2000
n_warmup_cycles = 5e+3
n_cycles_tot = 1e+7
imag_threshold = 1e-5

perform_tail_fit = true
fit_max_moment = 6
fit_min_w = 10
fit_max_w = 16
measure_density_matrix = true
</pre></div>
</div>
<p>Let’s go through some special options we set in the config file:</p>
<ul class="simple">
<li>we changed <code class="docutils literal notranslate"><span class="pre">n_iw=2000</span></code> because the large energy window of the calculation requires more Matsubara frequencies</li>
<li><code class="docutils literal notranslate"><span class="pre">h_int_type</span></code> is set to <code class="docutils literal notranslate"><span class="pre">density_density</span></code> to reduce complexity of the problem</li>
<li><code class="docutils literal notranslate"><span class="pre">beta=40</span></code> here we set the temperature to ~290K</li>
<li><code class="docutils literal notranslate"><span class="pre">magnetic=true</span></code> lift spin degeneracy</li>
<li><code class="docutils literal notranslate"><span class="pre">magmom</span></code> here we specify the magnetic order. Here, we say that both Ni sites have the same spin, which should average to 0 at this high temperature. The magnetic moment is specified as an potential in eV splitting up / down channel of the initial self-energy</li>
<li><code class="docutils literal notranslate"><span class="pre">afm_order=true</span></code> tells solid_dmft to not solve impurities with the same <code class="docutils literal notranslate"><span class="pre">magmom</span></code> but rather copy the self-energy and if necessary flip the spin accordingly</li>
<li><code class="docutils literal notranslate"><span class="pre">length_cycle=2000</span></code> is the length between two Green’s function measurements in cthyb. This number has to be choosen carefully to give an autocorrelation time ~1 for all orbitals</li>
<li><code class="docutils literal notranslate"><span class="pre">perform_tail_fit=true</span></code> : here we use tail fitting to get good high frequency self-energy behavior</li>
<li><code class="docutils literal notranslate"><span class="pre">measure_density_matrix</span> <span class="pre">=</span> <span class="pre">true</span></code> measures the impurity many-body density matrix in the Fock basis for a multiplet analysis</li>
</ul>
<p>By setting the flag magmom to a small value with a flipped sign on both sites we tell solid_dmft that both sites are related by flipping the down and up channel. Now we run solid_dmft simply by executing <code class="docutils literal notranslate"><span class="pre">mpirun</span> <span class="pre">solid_dmft</span> <span class="pre">config.toml</span></code>.</p>
<p>Caution: this is a very heavy job, which should be submitted on a cluster.</p>
<p>In the beginning of the calculation we find the following lines:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>AFM calculation selected, mapping self energies as follows:
imp  [copy sigma, source imp, switch up/down]
---------------------------------------------
0: [False, 0, False]
1: [True, 0, True]
</pre></div>
</div>
<p>this tells us that solid_dmft detected correctly how we want to orientate the spin moments. This also reflects itself during the iterations when the second impurity problem is not solved, but instead all properties of the first impurity are copied and the spin channels are flipped:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>...
copying the self-energy for shell 1 from shell 0
inverting spin channels: False
...
</pre></div>
</div>
<p>After the calculation is running or is finished we can take a look at the results:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">with</span> <span class="n">HDFArchive</span><span class="p">(</span><span class="n">path</span><span class="o">+</span><span class="s1">&#39;/nno.h5&#39;</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">ar</span><span class="p">:</span>
    <span class="n">Sigma_iw</span> <span class="o">=</span> <span class="n">ar</span><span class="p">[</span><span class="s1">&#39;DMFT_results/last_iter/Sigma_freq_0&#39;</span><span class="p">]</span>
    <span class="n">obs</span> <span class="o">=</span> <span class="n">ar</span><span class="p">[</span><span class="s1">&#39;DMFT_results/observables&#39;</span><span class="p">]</span>
    <span class="n">conv_obs</span> <span class="o">=</span> <span class="n">ar</span><span class="p">[</span><span class="s1">&#39;DMFT_results/convergence_obs&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="c1"># imp occupation</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;iteration&#39;</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;imp_occ&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;up&#39;</span><span class="p">])</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;imp_occ&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;down&#39;</span><span class="p">]),</span> <span class="s1">&#39;-o&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;Ni$_0$&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;iteration&#39;</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;imp_occ&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;up&#39;</span><span class="p">])</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;imp_occ&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;down&#39;</span><span class="p">]),</span> <span class="s1">&#39;-o&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;Ni$_1$&#39;</span><span class="p">)</span>

<span class="c1"># imp magnetization</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;iteration&#39;</span><span class="p">],</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;imp_occ&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;up&#39;</span><span class="p">])</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;imp_occ&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;down&#39;</span><span class="p">])),</span> <span class="s1">&#39;-o&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;Ni$_0$&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;iteration&#39;</span><span class="p">],</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;imp_occ&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;up&#39;</span><span class="p">])</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;imp_occ&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;down&#39;</span><span class="p">])),</span> <span class="s1">&#39;-o&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;Ni$_1$&#39;</span><span class="p">)</span>

<span class="c1"># dxy, dyz, dz2, dxz, dx2-y2 orbital magnetization</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;iteration&#39;</span><span class="p">],</span> <span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;orb_occ&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;up&#39;</span><span class="p">])[:,</span><span class="mi">4</span><span class="p">]</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;orb_occ&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;down&#39;</span><span class="p">])[:,</span><span class="mi">4</span><span class="p">]),</span> <span class="s1">&#39;-o&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$d_{x^2-y^2}$&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;iteration&#39;</span><span class="p">],</span> <span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;orb_occ&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;up&#39;</span><span class="p">])[:,</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;orb_occ&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;down&#39;</span><span class="p">])[:,</span><span class="mi">2</span><span class="p">]),</span> <span class="s1">&#39;-o&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$d_{z^2}$&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;iteration&#39;</span><span class="p">],</span> <span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;orb_occ&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;up&#39;</span><span class="p">])[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;orb_occ&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;down&#39;</span><span class="p">])[:,</span><span class="mi">0</span><span class="p">]),</span> <span class="s1">&#39;-o&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$d_</span><span class="si">{xy}</span><span class="s1">$&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;iteration&#39;</span><span class="p">],</span> <span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;orb_occ&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;up&#39;</span><span class="p">])[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;orb_occ&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;down&#39;</span><span class="p">])[:,</span><span class="mi">1</span><span class="p">]),</span> <span class="s1">&#39;-o&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$d_{yz/xz}$&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">semilogy</span><span class="p">(</span><span class="n">conv_obs</span><span class="p">[</span><span class="s1">&#39;d_Gimp&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;-o&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Imp. occupation&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;magnetization $\mu_B$&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;magnetization $\mu_B$&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;iteration&#39;</span><span class="p">])))</span>
<span class="n">ax</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Iterations&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mf">8.4</span><span class="p">,</span><span class="mf">8.6</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span><span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;|G$_</span><span class="si">{imp}</span><span class="s1">$-G$_</span><span class="si">{loc}</span><span class="s1">$|&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorials_NNO_os_plo_mag_tutorial_18_0.png" src="../../_images/tutorials_NNO_os_plo_mag_tutorial_18_0.png" />
</div>
</div>
<p>Let’s take a look at the self-energy of the two Ni <span class="math notranslate nohighlight">\(e_g\)</span> orbitals:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">oplot</span><span class="p">(</span><span class="n">Sigma_iw</span><span class="p">[</span><span class="s1">&#39;up_2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;C0&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;up $d_{z^2}$&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">oplot</span><span class="p">(</span><span class="n">Sigma_iw</span><span class="p">[</span><span class="s1">&#39;up_4&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;C1&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;up $d_{x^2-y^2}$&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">oplot</span><span class="p">(</span><span class="n">Sigma_iw</span><span class="p">[</span><span class="s1">&#39;down_2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;C0&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;down $d_{z^2}$&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">oplot</span><span class="p">(</span><span class="n">Sigma_iw</span><span class="p">[</span><span class="s1">&#39;down_4&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;C1&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;down $d_{x^2-y^2}$&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$Im \Sigma (i \omega)$&quot;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">40</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">1.8</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorials_NNO_os_plo_mag_tutorial_20_0.png" src="../../_images/tutorials_NNO_os_plo_mag_tutorial_20_0.png" />
</div>
</div>
<p>We can clearly see that a <span class="math notranslate nohighlight">\(\omega_n=8\)</span> the self-energy is replaced by the tail-fit as specified in the input config file. This cut is rather early, but ensures convergence. For higher sampling rates this has to be changed. We can also nicely observe a splitting of the spin channels indicating a magnetic solution, but we still have a metallic solution with both self-energies approaching 0 for small omega walues. However, the QMC noise is still rather high, especially in the
<span class="math notranslate nohighlight">\(d_{x^2-y^2}\)</span> orbital.</p>
</div>
<div class="section" id="5.-Multiplet-analysis">
<h2>5. Multiplet analysis<a class="headerlink" href="#5.-Multiplet-analysis" title="Permalink to this headline"></a></h2>
<p>We follow now the triqs/cthyb tutorial on the <a class="reference external" href="https://triqs.github.io/cthyb/unstable/guide/multiplet_analysis_notebook.html" rel="noopener noreferrer" target="_blank">multiplet analysis</a> to analyze the multiplets of the Ni-d orbitals:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.width&#39;</span><span class="p">,</span> <span class="mi">130</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">triqs.operators.util</span> <span class="kn">import</span> <span class="n">make_operator_real</span>
<span class="kn">from</span> <span class="nn">triqs.operators.util.observables</span> <span class="kn">import</span> <span class="n">S_op</span>
<span class="kn">from</span> <span class="nn">triqs.atom_diag</span> <span class="kn">import</span> <span class="n">quantum_number_eigenvalues</span>
<span class="kn">from</span> <span class="nn">triqs.operators</span> <span class="kn">import</span> <span class="n">n</span>
</pre></div>
</div>
</div>
<p>first we have to load the measured density matrix and the local Hamiltonian of the impurity problem from the h5 archive, which we stored by setting <code class="docutils literal notranslate"><span class="pre">measure_density_matrix=true</span></code> in the config file:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">with</span> <span class="n">HDFArchive</span><span class="p">(</span><span class="n">path</span><span class="o">+</span><span class="s1">&#39;/nno.h5&#39;</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">ar</span><span class="p">:</span>
    <span class="n">rho</span> <span class="o">=</span> <span class="n">ar</span><span class="p">[</span><span class="s1">&#39;DMFT_results/last_iter/full_dens_mat_0&#39;</span><span class="p">]</span>
    <span class="n">h_loc</span> <span class="o">=</span> <span class="n">ar</span><span class="p">[</span><span class="s1">&#39;DMFT_results/last_iter/h_loc_diag_0&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">rho</span></code> is just a list of arrays containing the weights of each of the impurity eigenstates (many body states), and <code class="docutils literal notranslate"><span class="pre">h_loc</span></code> is a:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">h_loc</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;class &#39;triqs.atom_diag.atom_diag.AtomDiagReal&#39;&gt;
</pre></div></div>
</div>
<p>containing the local Hamiltonian of the impurity including eigenstates, eigenvalues etc.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">res</span> <span class="o">=</span> <span class="p">[]</span>
<span class="c1"># get fundamental operators from atom_diag object</span>
<span class="n">occ_operators</span> <span class="o">=</span> <span class="p">[</span><span class="n">n</span><span class="p">(</span><span class="o">*</span><span class="n">op</span><span class="p">)</span> <span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="n">h_loc</span><span class="o">.</span><span class="n">fops</span><span class="p">]</span>

<span class="c1"># construct total occupation operator from list</span>
<span class="n">N_op</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">occ_operators</span><span class="p">)</span>

<span class="c1"># create Sz operator and get eigenvalues</span>
<span class="n">Sz</span><span class="o">=</span><span class="n">S_op</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="n">spin_names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;up&#39;</span><span class="p">,</span><span class="s1">&#39;down&#39;</span><span class="p">],</span> <span class="n">n_orb</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">off_diag</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">Sz</span> <span class="o">=</span> <span class="n">make_operator_real</span><span class="p">(</span><span class="n">Sz</span><span class="p">)</span>
<span class="n">Sz_states</span> <span class="o">=</span> <span class="n">quantum_number_eigenvalues</span><span class="p">(</span><span class="n">Sz</span><span class="p">,</span> <span class="n">h_loc</span><span class="p">)</span>

<span class="c1"># get particle numbers from h_loc_diag</span>
<span class="n">particle_numbers</span> <span class="o">=</span> <span class="n">quantum_number_eigenvalues</span><span class="p">(</span><span class="n">N_op</span><span class="p">,</span> <span class="n">h_loc</span><span class="p">)</span>
<span class="n">N_max</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">max</span><span class="p">,</span> <span class="n">particle_numbers</span><span class="p">)))</span>

<span class="k">for</span> <span class="n">sub</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">h_loc</span><span class="o">.</span><span class="n">n_subspaces</span><span class="p">):</span>

    <span class="c1"># first get Fock space spanning the subspace</span>
    <span class="n">fs_states</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">fs</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">h_loc</span><span class="o">.</span><span class="n">fock_states</span><span class="p">[</span><span class="n">sub</span><span class="p">]):</span>
        <span class="n">state</span> <span class="o">=</span> <span class="nb">bin</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">fs</span><span class="p">))[</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="n">N_max</span><span class="p">,</span> <span class="s1">&#39;0&#39;</span><span class="p">)</span>
        <span class="n">fs_states</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="o">+</span><span class="n">state</span><span class="o">+</span><span class="s2">&quot;&gt;&quot;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">h_loc</span><span class="o">.</span><span class="n">get_subspace_dim</span><span class="p">(</span><span class="n">sub</span><span class="p">)):</span>

        <span class="c1"># get particle number</span>
        <span class="n">particle_number</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">particle_numbers</span><span class="p">[</span><span class="n">sub</span><span class="p">][</span><span class="n">ind</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">particle_number</span><span class="o">-</span><span class="n">particle_numbers</span><span class="p">[</span><span class="n">sub</span><span class="p">][</span><span class="n">ind</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mf">1e-8</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;round error for particle number to large!&#39;</span><span class="p">,</span>
                             <span class="n">particle_numbers</span><span class="p">[</span><span class="n">sub</span><span class="p">][</span><span class="n">ind</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">particle_number</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">particle_number</span><span class="p">)</span>
        <span class="n">eng</span><span class="o">=</span><span class="n">h_loc</span><span class="o">.</span><span class="n">energies</span><span class="p">[</span><span class="n">sub</span><span class="p">][</span><span class="n">ind</span><span class="p">]</span>

        <span class="c1"># construct eigenvector in Fock state basis:</span>
        <span class="n">ev_state</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">elem</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">h_loc</span><span class="o">.</span><span class="n">unitary_matrices</span><span class="p">[</span><span class="n">sub</span><span class="p">][:,</span><span class="n">ind</span><span class="p">]):</span>
            <span class="n">ev_state</span> <span class="o">+=</span> <span class="s1">&#39; </span><span class="si">{:+1.4f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span><span class="o">+</span><span class="n">fs_states</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

        <span class="c1"># get spin state</span>
        <span class="n">ms</span><span class="o">=</span><span class="n">Sz_states</span><span class="p">[</span><span class="n">sub</span><span class="p">][</span><span class="n">ind</span><span class="p">]</span>

        <span class="c1"># add to dict which becomes later the pandas data frame</span>
        <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;Sub#&quot;</span> <span class="p">:</span> <span class="n">sub</span><span class="p">,</span>
                    <span class="s2">&quot;EV#&quot;</span> <span class="p">:</span> <span class="n">ind</span><span class="p">,</span>
                    <span class="s2">&quot;N&quot;</span> <span class="p">:</span> <span class="n">particle_number</span><span class="p">,</span>
                    <span class="s2">&quot;energy&quot;</span> <span class="p">:</span> <span class="n">eng</span><span class="p">,</span>
                    <span class="s2">&quot;prob&quot;</span><span class="p">:</span> <span class="n">rho</span><span class="p">[</span><span class="n">sub</span><span class="p">][</span><span class="n">ind</span><span class="p">,</span><span class="n">ind</span><span class="p">],</span>
                    <span class="s2">&quot;m_s&quot;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">ms</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span>
                    <span class="s2">&quot;|m_s|&quot;</span><span class="p">:</span> <span class="nb">abs</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">ms</span><span class="p">,</span><span class="mi">1</span><span class="p">)),</span>
                    <span class="s2">&quot;state&quot;</span><span class="p">:</span> <span class="n">ev_state</span><span class="p">})</span>
<span class="c1"># panda data frame from res</span>
<span class="n">res</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="nb">print</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;prob&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)[:</span><span class="mi">10</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
    Sub#  EV#   N        energy      prob  m_s  |m_s|                 state
4      4    0   9  3.640517e-01  0.310283 -0.5    0.5   +1.0000|0111111111&gt;
0      0    0   8  0.000000e+00  0.125113 -1.0    1.0   +1.0000|0101111111&gt;
5      5    0   9  3.640517e-01  0.083760  0.5    0.5   +1.0000|1111101111&gt;
20    20    0   8  8.851884e-01  0.074717  0.0    0.0   +1.0000|0111111011&gt;
2      2    0   9  2.739907e-01  0.044306 -0.5    0.5   +1.0000|1101111111&gt;
55    55    0  10  7.125334e+00  0.038609  0.0    0.0   +1.0000|1111111111&gt;
3      3    0   9  2.739907e-01  0.035831  0.5    0.5   +1.0000|1111111011&gt;
51    51    0   8  2.745626e+00  0.033932  0.0    0.0   +1.0000|0111101111&gt;
1      1    0   8  4.903654e-09  0.031693  1.0    1.0   +1.0000|1111101011&gt;
21    21    0   8  8.851884e-01  0.019748  0.0    0.0   +1.0000|1101101111&gt;
</pre></div></div>
</div>
<p>This table shows the eigenstates of the impurity with the highest weight / occurence probability. Each row shows the state of the system, where the 1/0 indicates if an orbital is occupied. The orbitals are ordered as given in the projectors (dxy, dyz, dz2, dxz, dx2-y2) from right to left, first one spin-channel, then the other. Additionally each row shows the particle sector of the state, the energy, and the <code class="docutils literal notranslate"><span class="pre">m_s</span></code> quantum number.</p>
<p>It can be seen, that the state with the highest weight is a state with one hole (N=9 electrons) in the <span class="math notranslate nohighlight">\(d_{x^2-y^2, up}\)</span> orbital carrying a spin of <code class="docutils literal notranslate"><span class="pre">0.5</span></code>. The second state in the list is a state with two holes (N=8). One in the <span class="math notranslate nohighlight">\(d_{x^2-y^2, up}\)</span> and one in the <span class="math notranslate nohighlight">\(d_{z^2, up}\)</span> giving a magnetic moment of 1. This is because the impurity occupation is somewhere between 8 and 9. We can also create a nice state histogram from this:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># split into ms occupations</span>
<span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>

<span class="n">spin_occ_five</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;N&#39;</span><span class="p">,</span> <span class="s1">&#39;|m_s|&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">pivot_df</span> <span class="o">=</span> <span class="n">spin_occ_five</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="s1">&#39;N&#39;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;|m_s|&#39;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="s1">&#39;prob&#39;</span><span class="p">)</span>
<span class="n">pivot_df</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">stacked</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">rot</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ax1</span><span class="p">)</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;prob amplitude&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorials_NNO_os_plo_mag_tutorial_33_0.png" src="../../_images/tutorials_NNO_os_plo_mag_tutorial_33_0.png" />
</div>
</div>
<p>This concludes the tutorial. This you can try next:</p>
<ul class="simple">
<li>try to find the transition temperature of the system by increasing the temperature in DMFT</li>
<li>improve the accuracy of the resulting self-energy by restarting the dmft calculation with more n_cycles_tot</li>
</ul>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../Ce2O3_csc_w90/tutorial.html" class="btn btn-neutral float-left" title="3. CSC with QE/W90 and HubbardI: total energy in Ce2O3" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../correlated_bandstructure/plot_correlated_bands.html" class="btn btn-neutral float-right" title="5. Plotting the spectral function" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright Copyright (C) 2018-2020, ETH Zurich Copyright (C) 2021-2022, The Simons Foundation authors: A. Hampel, M. Merkel, A. Carta, and S. Beck.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>